XCOMM $Id$
/* ---------------------------------------------------------------------- */

/*
 * Imakefile for Source of the xindy-Project
 *
 * (history at end)
 */


/* needed modules */
#include <Project.imk>
#include <noweb-wrap.imk>

/* This is a slight modification to the original rule from Lisp.imk.
   The problem is, that in a noweb-environment we can't implicitly
   assume that there is always a Lisp-source (.lsp) because these
   sources are actually generated by `notangle'. When compiling a
   .lsp->.fas clisp may fail due to other missing sources. A simple
   kludge is to make the ProgramTarget also dependend from other
   Lisp-sources of the project. We modify the `prog:' rule to `prog::'
   and allow to add separate rules of dependency which reflect the
   real source dependencies between several Lisp-sources.
*/

#ifndef LispModuleTarget
#define LispModuleTarget(module)                                        @@\
AllTarget(module)                                                       @@\
                                                                        @@\
module:: LispModuleObjects(module)
#endif /* LispModuleTarget */

/* This must be included after the redefinition of the above rule(s) */
#include <Lisp.imk>

/* Some convenience Macros */

#ifndef NowebLispTarget
#define NowebLispTarget(program)     	                                @@\
NowebTarget(program,lsp,)
#endif

/* In conjunction with the modified LispModuleTarget()-macro, we
   append the target `source' to all sources in the project (this is
   somewhat stupid, but works for now). Now the sources will be
   generated before clisp starts to compile anything.
*/
#ifndef NowebFullLispTarget
#define NowebFullLispTarget(source) 	                                @@\
source:: $(ALL_LISP_SRC)						@@\
NowebLispTarget(source)							@@\
LispModuleTarget(source)					       	@@\
NowebLaTeXDocTargetWrap(source,$(NW_HEADER),$(NW_TRAILER))
#endif



XCOMM ------------------------------------------------------------
XCOMM continue in Imakefile

      NW_HEADER  = ./header.tex
      NW_TRAILER = ./trailer.tex

      ALL_LISP_SRC = base.lsp basetype.lsp idxclass.lsp idxentry.lsp\
		     idxrule.lsp idxstyle.lsp index.lsp intface.lsp\
		     locclass.lsp locref.lsp ranges.lsp style.lsp\
		     xindy.lsp

      ALL_NOWEB_SRC = base.nw basetype.nw idxclass.nw idxentry.nw\
		     idxrule.nw idxstyle.nw index.nw intface.nw\
		     locclass.nw locref.nw ranges.nw style.nw\
		     xindy.nw

NowebFullLispTarget(base)
NowebFullLispTarget(basetype)
NowebFullLispTarget(idxclass)
NowebFullLispTarget(idxentry)
NowebFullLispTarget(idxrule)
NowebFullLispTarget(idxstyle)
NowebFullLispTarget(index)
NowebFullLispTarget(intface)
NowebFullLispTarget(locclass)
NowebFullLispTarget(locref)
NowebFullLispTarget(ranges)
NowebFullLispTarget(style)
NowebFullLispTarget(xindy)

NowebLaTeXDocTargetsWrap(xindy-all,$(NW_HEADER),$(NW_TRAILER),$(ALL_NOWEB_SRC))

CVSAdd(*.nw)
CVSAdd(Imakefile defwords.tex rcs.sty xindy-noweb.sty)
CVSCommentLeader("%% ", *.nw *.sty)
CVSCommit()

clean::
	$(RM) modules.tex

/* ============================================================
 *
 * $Log$
 * Revision 1.3  1995/12/07 13:21:18  kehr
 * Dies ist das Projekt zum Zeitpunkt der Abgabe.
 *
 * Revision 1.2  1995/10/17  15:56:57  kehr
 * Had to modifiy some rules of Lisp.imk. The original rule implicitly
 * expected that all sources are available which of course isn't always
 * true in a noweb-environment. The solution was to generate all sources
 * before starting to compile anything. I'll talk about that problem with
 * Gabor later when its neccessary to define modules and packages.
 *
 * Revision 1.1  1995/10/16  19:17:16  kehr
 * Added Imakefile-support for source.
 *

 * ------------------------------------------------------------
 * Local Variables:
 * mode: Indented-Text
 * End:
 */
